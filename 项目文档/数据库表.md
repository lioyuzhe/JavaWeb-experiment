### 数据库设计

> 数据库表开发说明： 
>
> - **所有数据库表全部不设置外键，数据库表的联系全部在代码逻辑中实现，这样便于之后修改数据库，同时也可以有效防止数据库操作是报错。**
>
> - **数据库表设计的时先采用了范式规范化设计，然后采用了反范式化设计，将小表合成大表，同时添加一些信息，虽然可能带有一定冗余，但是对后续功能的实现很友好。所以如果看到数据库有冗余信息不要大惊小怪。**
> - **所有的时间全部设置成 datetime ，除非要用到通过时间排序功能的设置成Date。**



#### 管理员有关表：

##### **1. admin 表（系统管理员表）**

就不设置role了，直接前端控制管理员和用户登录就可以。

| 字段名      | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                       |
| ----------- | -------- | -------- | -------- | ---------- | ------------------------------------------ |
| admin_id    | bigint   |          | N        | Y          | 管理员ID                                   |
|             |          |          |          |            |                                            |
| account     | varchar  | 256      | N        | N          | 账户名                                     |
| name        | varchar  | 256      | Y        | N          | 用户名  通过代码逻辑随机生成               |
| password    | varchar  | 256      | N        | N          | 密码                                       |
| avatar      | varchar  | 1024     | Y        | N          | 头像                                       |
| email       | varchar  | 256      | Y        | N          | 邮箱地址                                   |
| phone       | varchar  | 256      | Y        | N          | 手机号                                     |
|             |          |          |          |            |                                            |
|             |          |          |          |            |                                            |
|             |          |          |          |            |                                            |
| create_time | datetime |          | Y        | N          | 创建时间                                   |
| deleted     | tinyint  |          | N        | N          | 逻辑删除，默认为0 ，表示不删除，1 表示删除 |

##### **1. cafeteria_admin 表（食堂管理员表）**

| 字段名      | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                       |
| ----------- | -------- | -------- | -------- | ---------- | ------------------------------------------ |
| admin_id    | bigint   |          | N        | Y          | 食堂管理员ID                               |
| account     | varchar  | 256      | N        | N          | 账户名                                     |
| name        | varchar  | 256      | Y        | N          | 用户名  通过代码逻辑随机生成               |
| password    | varchar  | 256      | N        | N          | 密码                                       |
| avatar      | varchar  | 1024     | Y        | N          | 头像                                       |
| email       | varchar  | 256      | Y        | N          | 邮箱地址                                   |
| phone       | varchar  | 256      | Y        | N          | 手机号                                     |
|             |          |          |          |            |                                            |
|             |          |          |          |            |                                            |
|             |          |          |          |            |                                            |
| create_time | datetime | 256      | Y        | N          | 创建时间                                   |
| deleted     | tinyint  |          | N        | N          | 逻辑删除，默认为0 ，表示不删除，1 表示删除 |

#### 用户有关表：

##### **3. user 表（账号管理表）**

| 字段名         | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                                         |
| -------------- | -------- | -------- | -------- | ---------- | ------------------------------------------------------------ |
| user_id        | bigint   |          | N        | Y          | 用户ID                                                       |
| account        | varchar  | 256      | N        | N          | 账户名                                                       |
| name           | varchar  | 256      | Y        | N          | 用户名                                                       |
| password       | varchar  | 256      | N        | N          | 密码                                                         |
| avatar         | varchar  | 1024     | Y        | N          | 头像                                                         |
| email          | varchar  | 256      | Y        | N          | 邮箱                                                         |
| phone          | varchar  | 256      | Y        | N          | 手机号                                                       |
| status         | int      |          | N        | N          | 在线状态 , 默认为0,0表示离线，1表示在线        这里的在线状态可以还是在代码中实现，不要去修改代码了。 |
| activity_level | int      |          | Y        | N          | 活跃度                                                       |
|                |          |          |          |            |                                                              |
| role           | int      |          | N        | N          | 用户角色，0表示学生，1                                       |
|                |          |          |          |            |                                                              |
| deleted        | tinyint  |          | N        | N          | 逻辑删除，默认为0 ，表示不删除，1 表示删除                   |

##### **5. private_messages 表（私信表）**

| 字段名          | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                                         |
| --------------- | -------- | -------- | -------- | ---------- | ------------------------------------------------------------ |
| message_id      | bigint   |          | N        | Y          | 消息ID                                                       |
| sender_id       | bigint   |          | N        | N          | 发送者ID                                                     |
| sender_name     | varchar  | 256      | N        | N          | 发送者姓名                                                   |
| sender_avatar   | varchar  | 1024     | Y        | N          | 发送者头像                                                   |
| receiver_id     | bigint   |          | N        | N          | 接收者ID                                                     |
| receiver_name   | varchar  | 256      | N        | N          | 接受者姓名                                                   |
| receiver_avatar | varchar  | 1024     | Y        | N          | 接受者头像                                                   |
| content         | text     |          | N        | N          | 消息内容                                                     |
| timestamp       | datetime |          | N        | N          | 发送时间                                                     |
| read_status     | tinyint  |          | N        | N          | 阅读状态， 默认为0，表示未读，1表示已读。（这个功能看情况要不要实现，可能没必要） |
|                 |          |          |          |            |                                                              |
|                 |          |          |          |            |                                                              |
| deleted         | tinyint  |          | N        | N          | 逻辑删除，默认为0 ，表示不删除，1 表示删除                   |
|                 |          |          |          |            |                                                              |

##### conversation表 会话表

| 字段名            | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                               |
| ----------------- | -------- | -------- | -------- | ---------- | -------------------------------------------------- |
| conversation_id   | bigint   |          | N        | Y          | 会话ID                                             |
| user_one_id       | bigint   |          | N        | N          | 参与会话的用户之一的ID，外键关联user表             |
| user_one_name     | varchar  | 100      | N        | N          | 参与会话的用户之一的姓名                           |
| user_one_avatar   | varchar  | 255      | Y        | N          | 参与会话的用户之一的头像                           |
| user_two_id       | bigint   |          | N        | N          | 参与会话的另一用户的ID，外键关联user表             |
| user_two_name     | varchar  | 100      | N        | N          | 参与会话的另一用户的姓名                           |
| user_two_avatar   | varchar  | 255      | Y        | N          | 参与会话的另一用户的头像                           |
| last_message_id   | bigint   |          | N        | N          | 会话中最后一条消息的ID，外键关联private_messages表 |
| last_message_time | datetime |          | N        | N          | 会话中最后一条消息的发送时间                       |

#### 食堂有关表：

##### **2. cafeteria 表（食堂基本信息表）**

| 字段名       | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                       |
| ------------ | -------- | -------- | -------- | ---------- | ------------------------------------------ |
| cafeteria_id | bigint   |          | N        | Y          | 食堂ID                                     |
| name         | varchar  | 256      | N        | N          | 食堂名称                                   |
| location     | varchar  | 256      | Y        | N          | 位置                                       |
| description  | text     |          | Y        | N          | 描述信息                                   |
| admin_id     | bigint   |          | Y        | N          | 食堂管理员ID                               |
| admin_name   | varchar  | 256      | Y        | N          | 食堂管理员姓名                             |
| open_time    | datetime | 256      | Y        | N          | 开放时间                                   |
| close_time   | datetime | 256      | Y        | N          | 关闭时间                                   |
| deleted      | tinyint  |          | N        | N          | 逻辑删除，默认为0 ，表示不删除，1 表示删除 |



##### **4. cafeteria_remark 表（食堂评价信息表）**

| 字段名         | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                                       |
| -------------- | -------- | -------- | -------- | ---------- | ---------------------------------------------------------- |
| remark_id      | bigint   |          | N        | Y          | 评价ID                                                     |
| cafeteria_id   | bigint   |          | N        | N          | 食堂ID                                                     |
| cafeteria_name | varchar  | 256      | N        | N          | 食堂名                                                     |
| user_id        | bigint   |          | N        | N          | 用户ID                                                     |
| user_name      | varchar  | 256      | N        | N          | 用户名                                                     |
| content        | text     |          | Y        | N          | 评价内容                                                   |
| reply          | text     |          | Y        | N          | 对用户评价的回复                                           |
| status         | int      |          | N        | N          | 默认为0 ， 创建的时候默认为0, 0表示没有回复，1表示已回复。 |
|                |          |          |          |            |                                                            |
| create_time    | datetime | 256      | Y        | N          | 创建时间                                                   |
| deleted        | tinyint  |          | N        | N          | 逻辑删除，默认为0 ，表示不删除，1 表示删除                 |

##### **2. cafeteria_manage 表（食堂管理表，多对多关系表）**

| 字段名       | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                       |
| ------------ | -------- | -------- | -------- | ---------- | ------------------------------------------ |
| manage_id    | bigint   |          | N        | Y          | 管理记录ID                                 |
| admin_id     | bigint   |          | N        | N          | 食堂管理员ID                               |
| cafeteria_id | bigint   |          | N        | N          | 食堂ID                                     |
|              |          |          |          |            |                                            |
|              |          |          |          |            |                                            |
| deleted      | tinyint  |          | N        | N          | 逻辑删除，默认为0 ，表示不删除，1 表示删除 |
|              |          |          |          |            |                                            |

##### **4. cafeteria_notice 表（食堂活动公告表）**

| 字段名         | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                       |
| -------------- | -------- | -------- | -------- | ---------- | ------------------------------------------ |
| notice_id      | bigint   |          | N        | Y          | 公告ID                                     |
| cafeteria_id   | bigint   |          | N        | N          | 食堂ID                                     |
| cafeteria_name | varchar  | 256      | N        | N          | 食堂名                                     |
| title          | varchar  | 256      | N        | N          | 标题                                       |
| content        | text     |          | Y        | N          | 内容                                       |
| create_time    | datetime | 256      | Y        | N          | 创建时间                                   |
| deleted        | tinyint  |          | N        | N          | 逻辑删除，默认为0 ，表示不删除，1 表示删除 |
|                |          |          |          |            |                                            |

##### **5. vote 表（投票调查表） （ 有点复杂，先不实现）**

| 字段名         | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                       |
| -------------- | -------- | -------- | -------- | ---------- | ------------------------------------------ |
| vote_id        | bigint   |          | N        | Y          | 投票ID                                     |
| cafeteria_id   | bigint   |          | N        | N          | 食堂ID                                     |
| cafeteria_name | varchar  | 50       | Y        | N          | 食堂名称                                   |
| question       | varchar  | 256      | N        | N          | 问题                                       |
| options        | text     |          | N        | N          | 选项（JSON格式）                           |
| start_time     | datetime |          | N        | N          | 开始时间                                   |
| end_time       | datetime |          | N        | N          | 结束时间                                   |
| create_time    | datetime |          | Y        | N          | 创建时间                                   |
| deleted        | tinyint  |          | N        | N          | 逻辑删除，默认为0 ，表示不删除，1 表示删除 |

> **1. 数据库设计**
>
> **投票表（Votes Table）**
>
> - **ID**：投票的唯一标识。
> - **Title**：投票的标题。
> - **Description**：投票的描述。
> - **StartTime**：投票开始时间。
> - **EndTime**：投票结束时间。
>
> **投票选项表（Options Table）**
>
> - **OptionID**：每个选项的唯一标识。
> - **VoteID**：关联的投票ID。
> - **OptionDescription**：选项描述。
>
> ### **用户投票记录表（UserVotes Table）**
>
> - **UserID**：投票用户的唯一标识。
> - **VoteID**：关联的投票ID。
> - **OptionID**：用户选择的选项ID。
> - **VoteTime**：投票时间。

##### complaint 投诉表

| 字段名         | 字段类型 | 数据长度 | 能否为NULL | 是否为主键 | 备注                                   |
| -------------- | -------- | -------- | ---------- | ---------- | -------------------------------------- |
| complaint_id   | bigint   |          | N          | Y          | 投诉ID                                 |
| user_id        | bigint   |          | N          | N          | 用户ID                                 |
| user_name      | varchar  | 255      | N          | N          | 用户名                                 |
| cafeteria_id   | bigint   |          | N          | N          | 食堂ID                                 |
| cafeteria_name | varchar  | 255      | N          | N          | 食堂名                                 |
| content        | text     |          | Y          | N          | 投诉内容                               |
| status         | int      |          | N          | N          | 投诉处理状态，0表示未处理，1表示已处理 |
| reply          | text     |          | Y          | N          | 投诉处理回复内容                       |
| deleted        | tinyint  |          | N          | N          | 逻辑删除，默认为0表示不删除，1表示删除 |

##### **6. cafeteria_rank 表（食堂排名表）**

| Field          | Type    | Length | NULL | Key  | Note                                       |
| -------------- | ------- | ------ | ---- | ---- | ------------------------------------------ |
| rank_id        | bigint  |        | N    | Y    | Ranking ID                                 |
| cafeteria_id   | bigint  |        | N    | N    | Cafeteria ID                               |
| cafeteria_name | varchar | 100    | N    | N    | Name of the cafeteria                      |
| total_score    | float   |        | N    | N    | Total score                                |
| rank           | int     |        | N    | N    | Ranking                                    |
|                |         |        |      |      |                                            |
| deleted        | tinyint |        | N    | N    | 逻辑删除，默认为0 ，表示不删除，1 表示删除 |

#### 菜品有关表

##### **3. dish 表（菜品维护表）**

| 字段名         | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                       |
| -------------- | -------- | -------- | -------- | ---------- | ------------------------------------------ |
| dish_id        | bigint   | -        | N        | Y          | 菜品ID                                     |
| cafeteria_id   | bigint   | -        | N        | N          | 食堂ID                                     |
| cafeteria_name | varchar  | 256      | N        | N          | 食堂名                                     |
| name           | varchar  | 256      | N        | N          | 菜名                                       |
| price          | decimal  | -        | N        | N          | 价格                                       |
| cuisine        | varchar  | 256      | N        | N          | 菜系                                       |
| image_url      | varchar  | 256      | Y        | N          | 图片                                       |
| status         | int      | -        | N        | N          | 默认为0，0 表示普通菜品，1表示最新推荐菜品 |
| deleted        | tinyint  | -        | N        | N          | 逻辑删除，默认为0 ，表示不删除，1 表示删除 |

##### **6. promotion 表（促销信息表）**

| 字段名         | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                           |
| -------------- | -------- | -------- | -------- | ---------- | ---------------------------------------------- |
| promotion_id   | bigint   |          | N        | Y          | 促销ID                                         |
| cafeteria_id   | bigint   |          | N        | N          | 食堂ID                                         |
| cafeteria_name | varchar  | 256      | N        | N          | 食堂名称                                       |
| dish_id        | bigint   |          | N        | N          | 菜品id                                         |
| dish_name      | varchar  | 256      | N        | N          | 促销菜品名称                                   |
| start_time     | datetime |          | N        | N          | 开始时间                                       |
| end_time       | datetime |          | N        | N          | 结束时间                                       |
| description    | text     |          | Y        | N          | 描述信息                                       |
| image_url      | varchar  | 256      | Y        | N          | 图片                                           |
| status         | int      |          | N        | N          | 默认为0，0表示未开始；1表示进行中；2表示已结束 |
| create_time    | datetime |          | Y        | N          | 创建时间                                       |
| deleted        | tinyint  |          | N        | N          | 逻辑删除，默认为0表示不删除，1表示删除         |

##### **4. dish_remark 表（菜品评价表）**

| 字段名    | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                       |
| --------- | -------- | -------- | -------- | ---------- | ------------------------------------------ |
| remark_id | bigint   |          | N        | Y          | 评价ID                                     |
| user_id   | bigint   |          | N        | N          | 用户ID                                     |
| user_name | varchar  | 256      | N        | N          | 用户名称                                   |
| dish_id   | bigint   |          | N        | N          | 菜品ID                                     |
| dish_name | varchar  | 256      | N        | N          | 菜品名称                                   |
| content   | text     |          | Y        | N          | 评价内容                                   |
| score     | float    |          | Y        | N          | 评分                                       |
| deleted   | tinyint  |          | N        | N          | 逻辑删除，默认为0 ，表示不删除，1 表示删除 |

##### **7. dish_rank 表（菜品排名表）**

| 字段名         | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注   |
| -------------- | -------- | -------- | -------- | ---------- | ------ |
| rank_id        | bigint   |          | N        | Y          | 排名ID |
| cafeteria_id   | bigint   |          | N        | N          | 食堂ID |
| cafeteria_name | varchar  | 256      | N        | N          | 食堂名 |
| dish_id        | bigint   |          | N        | N          | 菜品ID |
| dish_name      | varchar  | 256      | N        | N          | 菜品名 |
| total_score    | float    |          | Y        | N          | 总评分 |
| rank           | int      |          | N        | N          | 排名   |

#### 社区有关表

##### **1. community 表（社区表）**

| 字段名       | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                                         |
| ------------ | -------- | -------- | -------- | ---------- | ------------------------------------------------------------ |
| community_id | bigint   |          | N        | Y          | 社区ID                                                       |
| user_id      | bigint   |          | N        | N          | 创建者用户ID 为某个用户创建                                  |
| user_name    | varchar  | 256      | Y        | N          | 创建者姓名，这里专门设计一个user_name,可以方便之后查询数据，二不用使用join连接数据库表 |
|              |          |          |          |            |                                                              |
|              |          |          |          |            |                                                              |
| name         | varchar  | 256      | N        | N          | 社区名称                                                     |
| description  | text     |          | Y        | N          | 社区描述                                                     |
| create_time  | datetime | 256      | Y        | N          | 创建时间                                                     |
| deleted      | tinyint  |          | N        | N          | 逻辑删除，默认为0表示不删除，1表示删除                       |

##### **2. community_user 表（社区用户表）**

| 字段名            | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                   |
| ----------------- | -------- | -------- | -------- | ---------- | -------------------------------------- |
| community_user_id | bigint   |          | N        | Y          | 社区用户ID                             |
| user_id           | bigint   |          | N        | N          | 用户ID                                 |
| user_name         | varchar  | 50       | N        | N          | 用户名                                 |
| community_id      | bigint   |          | N        | N          | 社区ID                                 |
| community_name    | varchar  | 50       | N        | N          | 社区名                                 |
| post_count        | int      |          | Y        | N          | 发布消息数                             |
| like_count        | int      |          | Y        | N          | 点赞总数                               |
| deleted           | tinyint  |          | N        | N          | 逻辑删除，默认为0表示不删除，1表示删除 |

##### **3. community_message 表（社区信息表）**

| 字段名         | 字段类型 | 数据长度 | 能否NULL | 是否为主键 | 备注                                                   |
| -------------- | -------- | -------- | -------- | ---------- | ------------------------------------------------------ |
| message_id     | bigint   |          | N        | Y          | 信息ID                                                 |
| community_id   | bigint   |          | N        | N          | 社区ID                                                 |
| community_name | varchar  | 256      | N        | N          | 社区名                                                 |
| user_id        | bigint   |          | N        | N          | 用户ID                                                 |
| user_name      | varchar  | 256      | N        | N          | 用户名                                                 |
| title          | varchar  | 256      | N        | N          | 标题                                                   |
| content        | text     |          | N        | N          | 内容（具体的存储的内容可以在前端通过富文本编辑器实现） |
| like_count     | int      |          | N        | N          | 点赞数                                                 |
| deleted        | tinyint  |          | N        | N          | 逻辑删除，默认为0表示不删除，1表示删除                 |



